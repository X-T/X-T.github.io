(function(){var t=function(a,g,k,f){return new Promise(function(e,d){var b=localStorage.getItem("lastFetchDate"),m=JSON.parse(localStorage.getItem("lastFetch"));f&&e(m);var n=function(c){return new Promise(function(l,r){fetch(g+"?action=fetch&id="+a,{method:"GET",mode:"cors",headers:{"If-Modified-Since":c}}).then(function(h){if(304===h.status)return{posts:[]};if(h.ok)return h.json();throw Error();}).then(function(h){l(h.posts)})["catch"](function(h){r(JSON.stringify(h))})})},p=function(c){return new Promise(function(){d(c)})},
  q=function(c){localStorage.setItem("lastFetch",JSON.stringify(c));localStorage.setItem("lastFetchDate",(new Date).toUTCString())};null===b?n("NEW_CLIENT").then(function(c){q(c);e(c)})["catch"](function(c){p(c)}):2>Math.floor((new Date-new Date(b))/36E5)&&!k?d({reason:"Checks are limited to two hours"}):n(b).then(function(c){for(var l=0;l<c.length;l++)m.push(c[l]);q(m);e(m)})["catch"](function(c){p(c)})})};window.guestbook_init=function(a){var g=function(f){alert(f)};a.hasOwnProperty("error")&&"function"===
typeof a.error&&(g=a.error);if(a.post.fields.hasOwnProperty("name")&&a.post.fields.hasOwnProperty("comment")&&a.post.fields.hasOwnProperty("captcha")&&"object"===typeof a.post.fields.name&&"object"===typeof a.post.fields.comment&&"object"===typeof a.post.fields.captcha){a.post.attachUsing(function(){var f=a.post.fields.name.value,e=a.post.fields.comment.value,d=a.post.fields.captcha.firstChild.dataset.hcaptchaResponse;32<f.length||128<e.length||""===e?g("Name or comment too long, comment may be empty."):
  ""===d?g("Captcha not solved."):(a.hasOwnProperty("hooks")&&a.hooks.hasOwnProperty("duringPost")&&"function"===typeof a.hooks.duringPost&&a.hooks.duringPost(),fetch(a.provider+"?action=post",{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:a.id,name:f,comment:e,captcha:d})}).then(function(b){return b.text()}).then(function(b){if(""===b)a.clearFrame(),k(!0),a.hasOwnProperty("hooks")&&a.hooks.hasOwnProperty("afterPost")&&"function"===typeof a.hooks.afterPost&&a.hooks.afterPost();
  else throw Error("Something happened.");})["catch"](function(b){console.log(b);g(JSON.stringify(b))}))});var k=function(f,e){t(a.id,a.provider,f?f:!1,e?e:!1).then(function(d){for(var b=0;b<d.length;b++)a.render(d[b].date,d[b].name,d[b].comment);a.hasOwnProperty("hooks")&&a.hooks.hasOwnProperty("afterRender")&&"function"===typeof a.hooks.afterRender&&a.hooks.afterRender()})["catch"](function(d){"Checks are limited to two hours"===d.reason?(a.clearFrame(),k(!1,!0),console.log("Checks are limited to two hours")):
  g(d.reason)})};k(!1)}else g("Missing/wrong fields.")}})();