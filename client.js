(function(){var t=function(a,c,k,g){return new Promise(function(f,e){var b=localStorage.getItem("lastFetchDate"),m=JSON.parse(localStorage.getItem("lastFetch"));g&&f(m);var n=function(d){return new Promise(function(l,r){fetch(c+"?action=fetch&id="+a,{method:"GET",mode:"cors",headers:{"If-Modified-Since":d}}).then(function(h){if(304===h.status)return{posts:[]};if(h.ok)return h.json();throw Error();}).then(function(h){l(h.posts)})["catch"](function(h){r(JSON.stringify(h))})})},p=function(d){return new Promise(function(){e(d)})},
q=function(d){localStorage.setItem("lastFetch",JSON.stringify(d));localStorage.setItem("lastFetchDate",(new Date).toUTCString())};null===b?n("NEW_CLIENT").then(function(d){q(d);f(d)})["catch"](function(d){p(d)}):2>Math.floor((new Date-new Date(b))/36E5)&&!k?e({reason:"Checks are limited to two hours"}):n(b).then(function(d){for(var l=0;l<d.length;l++)m.push(d[l]);q(m);f(m)})["catch"](function(d){p(d)})})};window.guestbook_init=function(a){var c=function(g){alert(g)};a.hasOwnProperty("error")&&"function"===
typeof a.error&&(c=a.error);if(a.hasOwnProperty("id"))if(a.hasOwnProperty("provider"))if(a.hasOwnProperty("post"))if(a.hasOwnProperty("render")&&"function"===typeof a.render)if(a.post.hasOwnProperty("attachUsing")&&"function"===typeof a.post.attachUsing)if(a.hasOwnProperty("clearFrame")&&"function"===typeof a.clearFrame)if(a.post.hasOwnProperty("fields"))if(!a.post.fields.hasOwnProperty("name")||!a.post.fields.hasOwnProperty("comment")||!a.post.fields.hasOwnProperty("captcha")||"object"!==typeof a.post.fields.name||
"object"!==typeof a.post.fields.comment,"object"!==typeof a.post.fields.captcha)c("Missing/wrong fields.");else{a.post.attachUsing(function(){var g=a.post.fields.name.value,f=a.post.fields.comment.value,e=a.post.fields.captcha.firstChild.dataset.hcaptchaResponse;32<g.length||128<f.length||""===f?c("Name or comment too long, comment may be empty."):""===e?c("Captcha not solved."):(a.hasOwnProperty("hooks")&&a.hooks.hasOwnProperty("duringPost")&&"function"===typeof a.hooks.duringPost&&a.hooks.duringPost(),
fetch(a.provider+"?action=post",{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:a.id,name:g,comment:f,captcha:e})}).then(function(b){return b.text()}).then(function(b){if(""===b)a.clearFrame(),k(!0),a.hasOwnProperty("hooks")&&a.hooks.hasOwnProperty("afterPost")&&"function"===typeof a.hooks.afterPost&&a.hooks.afterPost();else throw Error("Something happened.");})["catch"](function(b){console.log(b);c(JSON.stringify(b))}))});var k=function(g,f){t(a.id,a.provider,g?
g:!1,f?f:!1).then(function(e){for(var b=0;b<e.length;b++)a.render(e[b].date,e[b].name,e[b].comment);a.hasOwnProperty("hooks")&&a.hooks.hasOwnProperty("afterRender")&&"function"===typeof a.hooks.afterRender&&a.hooks.afterRender()})["catch"](function(e){"Checks are limited to two hours"===e.reason?(a.clearFrame(),k(!1,!0),console.log("Checks are limited to two hours")):c(e.reason)})};k(!1)}else c("No fields for post handler.");else c("Can't clear frame.");else c("Can't attach post handler.");else c("No render function given.");
else c("No guestbook post handler given.");else c("No guestbook provider given.");else c("No guestbook ID given.")}})();