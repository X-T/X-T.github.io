System.register(["./main-legacy.e8c0eb83.js","./vendor-legacy.7b751c72.js"],(function(){"use strict";var e,t;return{setters:[function(){},function(n){e=n.N,t=n.c}],execute:function(){const n=new e({backendUrl:"https://uxtafleoaetvphdawoed.nhost.run"}),o=e=>{document.getElementById(e).style.display="none"},a=e=>{document.getElementById(e).style.display="block"},s=e=>{e.forEach((e=>{const{name:t,comment:n,created_at:o}=e,a=new Date(o),s=a.toLocaleDateString(),c=a.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),d=t||"Anonymous",i=document.createElement("tr"),l=document.createElement("td"),m=document.createElement("td"),r=document.createElement("td");var g;l.innerText=d,m.innerText=n,r.innerText=`${s} ${c}`,i.appendChild(r),i.appendChild(l),i.appendChild(m),g=i,document.querySelector("#guestbookPosts > table > tbody").appendChild(g)}))},c=async(e=!1)=>{let t=JSON.parse(localStorage.getItem("posts")),o=localStorage.getItem("last_updated");if(t&&o&&!e){const e=new Date(o),n=(new Date).getTime()-e.getTime();if(n>=36e5&&(localStorage.removeItem("posts"),localStorage.removeItem("last_updated"),t=[],o=""),n<3e5)return t}const{error:a,data:s}=await n.graphql.request('\n  query Posts(\n    $timesincemodified: timestamptz = ""\n  ) {\n    posts(order_by: {created_at: desc},\n      where: {created_at: {\n        _gte: $timesincemodified\n      }}) {\n      name\n      created_at\n      comment\n    }\n  }\n  ',{timesincemodified:o||"1970-01-01"});if(a)throw a;const c=[...s.posts||[],...t||[]];return(e=>{localStorage.setItem("posts",JSON.stringify(e)),localStorage.setItem("last_updated",(new Date).toISOString())})(c),c};(async()=>{try{s(await c()),a("guestbookPosts"),o("guestbookLoading")}catch(e){t(e),a("guestbookLoading"),document.getElementById("guestbookLoading").innerText=e}})();const d=()=>{document.querySelector(".h-captcha").innerHTML="",hcaptcha.render(document.getElementsByClassName("h-captcha")[0])},i=e=>{const t=document.getElementById("errorPosting"),n=document.getElementById("guestbookError"),o=document.getElementById("postDialog");n.innerText=e,t.style.display="block",o.style.display="none"};window.postFunction=async e=>{const t=document.getElementById("guestbookName"),n=document.getElementById("guestbookComment"),l=t.value,m=n.value;if(o("postDialog"),a("postSubmitting"),m)if(l.length>32||m.length>128)i(`${l.length>32&&!(m.length>128)?"Name":""}${!(l.length>32)&&m.length>128?"Comment":""}${l.length>32&&m.length>128?"Name and comment":""} too long!`);else try{const r=await fetch("https://old-flower-8394.fly.dev/post",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:l,comment:m,captcha_response:e})});if(o("postSubmitting"),201===r.status)return d(),t.value="",n.value="",a("postDialog"),o("guestbookPosts"),a("guestbookLoading"),document.querySelector("#guestbookPosts > table > tbody").innerHTML="\n<TABLE BORDER=1>\n  <TR>\n     <TH>Date</TH>\n     <TH>Name</TH>\n     <TH>Comment</TH>\n  </TR>\n</TABLE>",void setTimeout((async()=>{const e=await c(!0);s(e),a("guestbookPosts"),o("guestbookLoading")}),1500);const g=await r.text();i(g)}catch(r){return void i(r)}else i("Comment cannot be empty!")},window.retryForm=()=>{d();const e=document.getElementById("errorPosting"),t=document.getElementById("postDialog");e.style.display="none",t.style.display="block"}}}}));
