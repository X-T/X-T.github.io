System.register(["./style-legacy.a654b618.js","./vendor-legacy.a67d5c3d.js"],(function(){"use strict";var e;return{setters:[function(){},function(t){e=t.c}],execute:function(){const t=e("https://aofovxzhgpxfmlnhsaap.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJyb2xlIjoiYW5vbiIsImlhdCI6MTY0MTUwNDM3MiwiZXhwIjoxOTU3MDgwMzcyfQ.v35MEidCtffHN1KTZVUOYgzCpx3S3PGn-d3TmpoDcfk"),o=e=>{document.getElementById(e).style.display="none"},n=e=>{document.getElementById(e).style.display="block"},a=e=>{e.forEach((e=>{const{name:t,comment:o,created_at:n}=e,a=new Date(n),s=a.toLocaleDateString(),l=a.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),c=null!=t?t:"Anonymous",d=document.createElement("tr"),i=document.createElement("td"),m=document.createElement("td"),r=document.createElement("td");var g;i.innerText=c,m.innerText=o,r.innerText=`${s} ${l}`,d.appendChild(r),d.appendChild(i),d.appendChild(m),g=d,document.querySelector("#guestbookPosts > table > tbody").appendChild(g)}))},s=async(e=!1)=>{var o,n;let a=JSON.parse(localStorage.getItem("posts")),s=localStorage.getItem("last_updated");if(a&&s&&!e){const e=new Date(s),t=(new Date).getTime()-e.getTime();if(t>=36e5&&(localStorage.removeItem("posts"),localStorage.removeItem("last_updated"),a=[],s=""),t<3e5)return a}const{error:l,data:c}=await t.from("Posts").select("created_at,name,comment").gte("created_at",null!==(o=s)&&void 0!==o?o:"1970-01-01").order("created_at",{ascending:!1});if(l)throw l.message;const d=[...null!=c?c:[],...null!==(n=a)&&void 0!==n?n:[]];return(e=>{localStorage.setItem("posts",JSON.stringify(e)),localStorage.setItem("last_updated",(new Date).toISOString())})(d),d};(async()=>{try{a(await s()),n("guestbookPosts"),o("guestbookLoading")}catch(e){n("guestbookLoading"),document.getElementById("guestbookLoading").innerText=e}})();const l=()=>{document.querySelector(".h-captcha").innerHTML="",hcaptcha.render(document.getElementsByClassName("h-captcha")[0])},c=e=>{const t=document.getElementById("errorPosting"),o=document.getElementById("guestbookError"),n=document.getElementById("postDialog");o.innerText=e,t.style.display="block",n.style.display="none"};window.postFunction=async e=>{const t=document.getElementById("guestbookName"),d=document.getElementById("guestbookComment"),i=t.value,m=d.value;if(o("postDialog"),n("postSubmitting"),m)if(i.length>32||m.length>128)c(`${i.length>32&&!(m.length>128)?"Name":""}${!(i.length>32)&&m.length>128?"Comment":""}${i.length>32&&m.length>128?"Name and comment":""} too long!`);else try{const r=await fetch("https://old-flower-8394.fly.dev/post",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:i,comment:m,captcha_response:e})});if(o("postSubmitting"),201===r.status)return l(),t.value="",d.value="",n("postDialog"),o("guestbookPosts"),n("guestbookLoading"),document.querySelector("#guestbookPosts > table > tbody").innerHTML="\n<TABLE BORDER=1>\n  <TR>\n     <TH>Date</TH>\n     <TH>Name</TH>\n     <TH>Comment</TH>\n  </TR>\n</TABLE>",void setTimeout((async()=>{const e=await s(!0);a(e),n("guestbookPosts"),o("guestbookLoading")}),1500);const g=await r.text();c(g)}catch(r){return void c(r)}else c("Comment cannot be empty!")},window.retryForm=()=>{l();const e=document.getElementById("errorPosting"),t=document.getElementById("postDialog");e.style.display="none",t.style.display="block"}}}}));
